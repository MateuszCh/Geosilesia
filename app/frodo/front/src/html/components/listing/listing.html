<section class="p-a-3 p-a-1-m p-a-1-s">
    <div class="pos-relative" layout="row" layout-xs="column" layout-align="center center">

        <h2 class="font-2 fs-6 center"
            flex="grow">
            <span class="font-2" ng-bind="::vm.listing.title"></span>
            <span class="font-2 fs-1" ng-bind="'(' + vm.listing.count + ')'"></span>
        </h2>
        <div layout="row" layout-align-xs="space-around center">
            <md-button class="md-primary"
                       ng-class="{'md-fab' : !$root.$mdMedia('xs'), 'md-raised' : $root.$mdMedia('xs')}"
                       ng-click="vm.listing.add()">
                <span class="col-w">Add</span>
                <md-tooltip md-direction="bottom">Add new {{::vm.listing.title}}</md-tooltip>
            </md-button>
            <md-button class="md-primary"
                       ng-class="{'md-fab' : !$root.$mdMedia('xs'), 'md-raised' : $root.$mdMedia('xs')}"
                       ng-if="vm.listing.type === 'posts'"
                       ng-click="vm.listing.postTypeEdit()">
                <span class="col-w">Edit</span>
                <md-tooltip md-direction="bottom">Edit {{::vm.listing.title}}</md-tooltip>
            </md-button>
            <md-menu md-position-mode="target-right target">
                <md-button
                        class=" md-primary"
                        ng-class="{'md-fab' : !$root.$mdMedia('xs'), 'md-raised' : $root.$mdMedia('xs')}"
                        aria-label="Sort by"
                        ng-click="$mdMenu.open()">
                    <md-icon md-svg-icon="sort"></md-icon>
                    <md-tooltip md-direction="bottom">Sort By</md-tooltip>
                </md-button>
                <md-menu-content width="4">
                    <md-menu-item ng-repeat="sort in vm.listing.sort.types">
                        <md-button ng-click="vm.listing.sort.sortBy(sort.varName)"
                                   class="transition"
                                   ng-class="{'bg-col-1 col-w' : vm.listing.sort.currentType == sort.varName}">
                            {{sort.name}}
                        </md-button>
                    </md-menu-item>
                </md-menu-content>
            </md-menu>
            <md-button hide-gt-md
                       ng-click="vm.openFilters()"
                       ng-class="{'md-fab' : !$root.$mdMedia('xs'), 'md-raised' : $root.$mdMedia('xs')}"
                       class="md-primary"
                       ng-if="vm.listing.type === 'posts'">
                <span class="col-w">Filters</span>
            </md-button>
        </div>
    </div>

    <div layout-xs="column"
         layout-gt-xs="row"
         class="m-t-4">
        <div flex-sm="100"
             flex-md="70"
             flex-gt-md="65">
            <p class="center"
               ng-if="!vm.listing.models.length">There are no&nbsp;<span ng-bind="::vm.listing.title || vm.model.data.title.toLowerCase()"></span>&nbsp;yet</p>
            <p class="center"
               ng-if="(vm.listing.models | listingFilter: vm.listing.filters : vm.listing.type).length === 0">There are no <span ng-bind="::vm.listing.title.toLowerCase() || vm.model.data.title.toLowerCase()"></span> matching your selection</p>
            <md-list class="p-t-0">
                <md-list-item layout="row"
                              ng-repeat="model in vm.listing.models | listingFilter : vm.listing.filters : vm.listing.type | orderBy: vm.listing.sort.currentType track by model._id"
                              class="md-button md-raised"
                              ng-class="{'m-b-2' : !$last}">
                    <div layout="row" flex="100" ng-if="vm.listing.lastRemoved !== model">
                        <a flex="80"
                           ui-sref="{{vm.listing.postEdit}}"
                           layout="row"
                           layout-align="left center"
                           ng-bind="::model.title"></a>
                        <md-button class="md-raised md-warn"
                                   flex="20"
                                   ng-click="vm.listing.removeDialog($event, model)"
                                   ng-class="{'busy' : vm.listing.removeStatus.busy == model._id && !vm.listing.removeStatus.status}">Delete</md-button>
                    </div>
                    <div ng-if="vm.listing.lastRemoved === model" flex="100" layout layout-align="center center">
                        <p ng-class="vm.listing.removeStatus.status == 200 ? 'col-6' : 'col-4'"
                           ng-bind="vm.listing.removeStatus.result"
                           ng-if="vm.listing.removeStatus.result"></p>
                    </div>

                </md-list-item>
            </md-list>
        </div>
        <div class="p-r-2 p-l-4" flex="auto" hide-xs hide-sm sticky>
            <div ng-repeat="filterType in ::vm.listing.filters" ng-if="vm.listing.models.length" ng-switch="::filterType.type" layout-wrap>
                <md-input-container class="md-block m-b-0" flex-gt-sm ng-switch-when="text" flex="100">
                    <label for="textFilter">Search</label>
                    <input id="textFilter" ng-model="vm.listing.filters.textFilter.value">
                </md-input-container>
                <div ng-repeat="field in ::filterType.fields track by field.id" class="p-t-1 p-b-1" ng-switch-when="checkbox" flex="100">
                    <p class="p-b-1" ng-bind="field.title"></p>
                    <md-radio-group ng-model="field.value" layout="row">
                        <md-radio-button ng-value="true" class="md-primary m-r-8">True</md-radio-button>
                        <md-radio-button ng-value="false" class="md-primary m-r-8">False</md-radio-button>
                        <md-radio-button ng-value="'all'" class="md-primary m-r-8">All</md-radio-button>
                    </md-radio-group>
                </div>
                <div ng-repeat="field in ::filterType.fields track by field.id" ng-switch-when="select" flex="100" layout="row" layout-wrap>
                    <md-input-container class="block" flex="100">
                        <label ng-bind="'Select ' + field.title"></label>
                        <md-select ng-model="field.values" multiple>
                            <md-option ng-value="option" ng-repeat="option in ::field.options">{{option}}</md-option>
                        </md-select>
                    </md-input-container>
                </div>
                <div ng-switch-when="number" ng-repeat="field in ::filterType.fields track by field.id">
                    <p ng-bind="field.title"></p>
                    <div layout="row">
                        <md-slider-container flex="80" layout="row">
                            <md-slider min="{{field.range[0]}}" max="{{field.maxValue || field.range[1]}}" ng-model="field.minValue"></md-slider>
                        </md-slider-container>

                        <md-input-container flex="20">
                            <label>Minimum</label>
                            <input type="number" ng-min="{{field.range[0]}}" ng-max="{{field.maxValue || field.range[1]}}" class="center" flex="100" ng-model="field.minValue">
                        </md-input-container>
                    </div>
                    <div layout="row">
                        <md-slider-container flex="80" layout="row">
                            <md-slider max="{{field.range[1]}}" min="{{field.minValue || field.range[0]}}" ng-model="field.maxValue"></md-slider>
                        </md-slider-container>

                        <md-input-container flex="20">
                            <label>Maximum</label>
                            <input type="number" class="center" ng-min="{{field.minValue || field.range[0]}}" ng-max="{{field.range[1]}}" flex="100" ng-model="field.maxValue">
                        </md-input-container>
                    </div>
                </div>
            </div>
            <div layout="row" layout-align="center end">
                <md-button class="md-raised md-primary m-a-0 p-r-2 p-l-2" ng-click="vm.listing.resetFilters(vm.listing.filters, vm.listing.type)">Reset Filters</md-button>
            </div>
        </div>
    </div>
</section>
<md-sidenav md-component-id="filters" class="md-sidenav-right" hide-gt-md md-whiteframe="4">
    <div class="p-a-2">
        <div ng-repeat="filterType in ::vm.listing.filters" ng-if="vm.listing.models.length" ng-switch="::filterType.type" layout-wrap>
            <md-input-container class="md-block m-b-0" flex-gt-sm ng-switch-when="text" flex="100">
                <label for="textFilter">Search</label>
                <input id="textFilter" ng-model="vm.listing.filters.textFilter.value">
            </md-input-container>
            <div ng-repeat="field in ::filterType.fields track by field.id" class="p-t-1 p-b-1" ng-switch-when="checkbox" flex="100">
                <p class="p-b-1" ng-bind="field.title"></p>
                <md-radio-group ng-model="field.value" layout="row">
                    <md-radio-button ng-value="true" class="md-primary m-r-8">True</md-radio-button>
                    <md-radio-button ng-value="false" class="md-primary m-r-8">False</md-radio-button>
                    <md-radio-button ng-value="'all'" class="md-primary m-r-8">All</md-radio-button>
                </md-radio-group>
            </div>
            <div ng-repeat="field in ::filterType.fields track by field.id" ng-switch-when="select" flex="100" layout="row" layout-wrap>
                <md-input-container class="block" flex="100">
                    <label ng-bind="'Select ' + field.title"></label>
                    <md-select ng-model="field.values" multiple>
                        <md-option ng-value="option" ng-repeat="option in ::field.options">{{option}}</md-option>
                    </md-select>
                </md-input-container>
            </div>
            <div ng-switch-when="number" ng-repeat="field in ::filterType.fields track by field.id">
                <p ng-bind="field.title"></p>
                <div layout="row">
                    <md-slider-container flex="80" layout="row">
                        <md-slider min="{{field.range[0]}}" max="{{field.maxValue || field.range[1]}}" ng-model="field.minValue"></md-slider>
                    </md-slider-container>

                    <md-input-container flex="20">
                        <label>Minimum</label>
                        <input type="number" ng-min="{{field.range[0]}}" ng-max="{{field.maxValue || field.range[1]}}" class="center" flex="100" ng-model="field.minValue">
                    </md-input-container>
                </div>
                <div layout="row">
                    <md-slider-container flex="80" layout="row">
                        <md-slider max="{{field.range[1]}}" min="{{field.minValue || field.range[0]}}" ng-model="field.maxValue"></md-slider>
                    </md-slider-container>

                    <md-input-container flex="20">
                        <label>Maximum</label>
                        <input type="number" class="center" ng-min="{{field.minValue || field.range[0]}}" ng-max="{{field.range[1]}}" flex="100" ng-model="field.maxValue">
                    </md-input-container>
                </div>
            </div>
        </div>
        <div layout="row" layout-align="center end">
            <md-button class="md-raised md-primary m-a-0 p-r-2 p-l-2" ng-click="vm.listing.resetFilters(vm.listing.filters, vm.listing.type)">Reset Filters</md-button>
        </div>
    </div>
    </div>
</md-sidenav>
